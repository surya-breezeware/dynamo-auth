import{__awaiter as t}from"tslib";import{Hub as e}from"aws-amplify";import{appendToCognitoUserAgent as a}from"@aws-amplify/auth";import{waitFor as n}from"xstate/lib/waitFor.js";import{ALLOWED_SPECIAL_CHARACTERS as i}from"./constants.mjs";import{getActorState as o}from"./actor.mjs";const s=({packageName:t,version:e})=>{a(`${t}/${e}`)},r=t=>{const e=t.trim().split("");for(let t=0;t<e.length;t++)t>0&&t<e.length-1&&(e[t]="*");return e.join("")},c=t=>{if(t.length<4)return t;const e=t.split("");for(let t=0;t<e.length-4;t++)e[t]="*";return e.join("")},l=e=>t(void 0,void 0,void 0,(function*(){try{yield n(e,(t=>o(t).matches("autoSignIn")))}catch(t){}})),d=(e,a)=>t(void 0,void 0,void 0,(function*(){const{send:t}=a,n=a.getSnapshot();switch(e.payload.event){case"tokenRefresh":n.matches("authenticated.idle")&&t("TOKEN_REFRESH");break;case"autoSignIn":if(!n.matches("authenticated")){yield l(a);const n=o(a.getSnapshot());(null==n?void 0:n.matches("autoSignIn"))&&t({type:"AUTO_SIGN_IN",data:e.payload.data})}break;case"autoSignIn_failure":{yield l(a);const n=o(a.getSnapshot());(null==n?void 0:n.matches("autoSignIn"))&&t({type:"AUTO_SIGN_IN_FAILURE",data:e.payload.data});break}case"signOut":case"tokenRefresh_failure":n.matches("authenticated.idle")&&t("SIGN_OUT")}})),u=(t,a=d)=>e.listen("auth",((t,e)=>a=>{e(a,t)})(t,a),"authenticator-hub-handler"),h=t=>i.some((e=>t.includes(e))),m=(t,e,a)=>encodeURI(`otpauth://totp/${t}:${e}?secret=${a}&issuer=${t}`);function p(t,...e){return Object.entries(t).reduce(((t,[a,n])=>Object.assign(Object.assign({},t),{[a]:e.includes(a)?n:null==n?void 0:n.trim()})),{})}export{r as censorAllButFirstAndLast,c as censorPhoneNumber,s as configureComponent,d as defaultAuthHubHandler,m as getTotpCodeURL,h as hasSpecialChars,u as listenToAuthHub,p as trimValues};
